# =============================================================================
# MNKY MUZIK – Environment variables
# =============================================================================
# Copy to .env.local for local development. For production (Vercel), set these
# in the Vercel project → Settings → Environment Variables.
# See docs/ENV_VERCEL.md for a production checklist.
#
# Development auth flow (login, Spotify OAuth, session persistence):
# 1. Start Supabase: pnpm run supabase:start (or supabase start). Then: pnpm exec supabase status
# 2. Copy from status: Project URL → NEXT_PUBLIC_SUPABASE_URL; Publishable → NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY; Secret → SUPABASE_SERVICE_ROLE_KEY; Database URL → DATABASE_URL
# 3. Set NEXT_PUBLIC_SITE_URL=http://localhost:3000 so redirects land on the Next.js app
# 4. Set SPOTIFY_CLIENT_ID and SPOTIFY_CLIENT_SECRET in .env.local. In Spotify app Redirect URIs add: http://127.0.0.1:54406/auth/v1/callback (local Supabase Auth callback)
# 5. supabase/config.toml [auth] already has site_url and additional_redirect_urls for localhost (including /auth/callback); no Studio change needed for dev
# =============================================================================

# ============== Supabase ==============
# Production: Supabase Dashboard → Project Settings → API (URL + anon key + service_role key).
# Local: run `pnpm exec supabase status` after `pnpm run supabase:start`. Map output to:
#   Project URL     → NEXT_PUBLIC_SUPABASE_URL
#   Publishable     → NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY (code also accepts NEXT_PUBLIC_SUPABASE_ANON_KEY)
#   Secret          → SUPABASE_SERVICE_ROLE_KEY (CRITICAL: required for saving Spotify tokens in callback)
#
# IMPORTANT: All three variables MUST be from the SAME Supabase project. Mixing URLs and keys from
# different projects will cause authentication and token persistence to fail.
#
# SUPABASE_SERVICE_ROLE_KEY is CRITICAL in production - if missing, Spotify OAuth will succeed but
# tokens won't be persisted, causing "From Spotify" features to fail. The callback route validates
# this at startup and will redirect to an error page if it's missing in production.
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54406
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=your_supabase_publishable_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# Database (direct Postgres – migrations, scripts). Production: Supabase Dashboard → Database → Connection string (URI).
# Local: use Database URL from `supabase status`; port must match supabase/config.toml [db] (e.g. 54403).
DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:54403/postgres

# Storage S3 (optional – S3-compatible access to Supabase Storage)
# Production: Supabase Dashboard → Storage → S3 Access or use external MinIO vars below.
# Local: URL and keys from `supabase status` → Storage (S3).
SUPABASE_STORAGE_S3_URL=http://127.0.0.1:54406/storage/v1/s3
SUPABASE_STORAGE_ACCESS_KEY=your_storage_access_key
SUPABASE_STORAGE_SECRET_KEY=your_storage_secret_key
SUPABASE_STORAGE_REGION=local

# ============== Stripe ==============
# Production: https://dashboard.stripe.com/apikeys (live keys). Webhook: Developers → Webhooks → Add endpoint.
# Local: use test keys; run `stripe listen --forward-to localhost:3000/api/webhooks` for webhook secret.
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_stripe_webhook_signing_secret

# ============== Spotify ==============
# Same app for Client Credentials (libs/spotify.ts) and Supabase Spotify OAuth.
# Production: https://developer.spotify.com/dashboard → your app. Add Supabase callback URL to Redirect URIs.
# Local: set in .env.local. Use `pnpm run supabase:start` so Supabase loads these (dotenv -e .env.local).
# In Spotify app Redirect URIs add: http://127.0.0.1:54406/auth/v1/callback (local Supabase Auth callback).
SPOTIFY_CLIENT_ID=your_spotify_client_id
SPOTIFY_CLIENT_SECRET=your_spotify_client_secret

# ============== Navidrome (Subsonic API – music catalog & streaming) ==============
# Production: your Navidrome server URL and a dedicated app user.
# Local: e.g. http://localhost:4533 or your LAN URL.
NAVIDROME_URL=http://localhost:4533
NAVIDROME_USER=your_navidrome_username
NAVIDROME_PASSWORD=your_navidrome_password

# ============== Lidarr (request music – add artist/album, search) ==============
# Production: your Lidarr URL and API key (Settings → General → API Key).
LIDARR_URL=http://localhost:8686
LIDARR_API_KEY=your_lidarr_api_key
# Optional when adding artists via API:
# LIDARR_ROOT_FOLDER_PATH=/music
# LIDARR_QUALITY_PROFILE_ID=1
# LIDARR_METADATA_PROFILE_ID=1

# ============== OpenAI (AI playlists, search, recommendations) ==============
# Server-only. Production: https://platform.openai.com/api-keys
OPENAI_API_KEY=your_openai_api_key_here

# ============== YouTube (Related music videos in now-playing) ==============
# Optional. Server-only. Production: https://console.cloud.google.com/apis/credentials
# When set, the expanded now-playing view shows "Related music videos" from YouTube search.
YOUTUBE_API_KEY=

# ============== App ==============
# Production: set to your canonical site URL (e.g. https://muzik.moodmnky.com).
# Used for: link previews (OG/Twitter), auth redirects (must match Supabase Auth → URL Configuration).
NEXT_PUBLIC_SITE_URL=http://localhost:3000

# RBAC / subscription bypass
# Production: set to false (or omit). Local dev: set to true to allow any logged-in user to play without subscription.
NEXT_PUBLIC_DEV_BYPASS_SUBSCRIPTION=false
# Server-only: PIN for beta access (optional).
BETA_ACCESS_PIN=

# ============== Optional – OAuth providers (Supabase Auth) ==============
# If you enable GitHub (or other) in Supabase Dashboard → Auth → Providers, add:
# GITHUB_CLIENT_ID=your_github_client_id
# GITHUB_SECRET=your_github_client_secret

# ============== Optional – External MinIO / S3 ==============
# If you use MinIO (or other S3-compatible) instead of Supabase Storage, set:
# MINIO_ENDPOINT_EXTERNAL=https://s3-api.example.com
# MINIO_CONSOLE_EXTERNAL=https://s3-console.example.com
# MINIO_ACCESS_KEY=your_minio_access_key
# MINIO_SECRET_KEY=your_minio_secret_key
# MINIO_BUCKET_NAME=your_bucket_name
# MINIO_REGION=us-east-1
# MINIO_SERVER_LOCATION=us-east-1
